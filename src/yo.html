<!DOCTYPE html>
<html class="mobile-web-player" lang="en" dir="ltr">
<head>
<meta charSet="utf-8"/>
<title>Spotify – Mobile Web Player</title>
<link rel="icon" sizes="32x32" type="image/png" href="https://open.spotifycdn.com/cdn/images/favicon32.b64ecc03.png"/>
<link rel="icon" sizes="16x16" type="image/png" href="https://open.spotifycdn.com/cdn/images/favicon16.1c487bff.png"/>
<link rel="icon" href="https://open.spotifycdn.com/cdn/images/favicon.0f31d2ea.ico"/>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="preload" href="https://encore.scdn.co/fonts/SpotifyMixUI-Regular-cc3b1de388efa4cbca6c75cebc24585e.woff2" as="font" type="font/woff2" crossorigin="anonymous"/>
<link rel="preload" href="https://encore.scdn.co/fonts/SpotifyMixUITitleVariable-8769ccfde3379b7ebcadd9529b49d0cc.woff2" as="font" type="font/woff2" crossorigin="anonymous"/>
<link rel="preload" href="https://encore.scdn.co/fonts/SpotifyMixUI-Bold-4264b799009b1db5c491778b1bc8e5b7.woff2" as="font" type="font/woff2" crossorigin="anonymous"/>
<link rel="preload" href="https://encore.scdn.co/fonts/SpotifyMixUITitleVariable-8769ccfde3379b7ebcadd9529b49d0cc.woff2" as="font" type="font/woff2" crossorigin="anonymous"/>
<meta property="og:site_name" content="Spotify"/>
<meta property="fb:app_id" content="174829003346"/>
<link rel="canonical" href="https://open.spotify.com/download"/>
<link rel="manifest" href="https://open.spotifycdn.com/cdn/generated/manifest-mobile-web-player.a1ddf51c.json"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
body{background:#121212;color:#fff;overflow-x:hidden}
.app-container{display:flex;flex-direction:column;min-height:100vh;padding:20px;padding-bottom:80px}
.container{max-width:100%}
h1,h2{color:#1DB954;margin:15px 0}
.section{margin-bottom:20px}
.carousel-container{position:relative;overflow:hidden;padding-bottom:20px}
.carousel{display:flex;overflow-x:auto;scroll-snap-type:x mandatory;scroll-behavior:smooth;-webkit-overflow-scrolling:touch;padding:0 5px;gap:15px}
.carousel::-webkit-scrollbar{display:none}
.card{flex:0 0 180px;background:#1e1e1e;border-radius:10px;overflow:hidden;scroll-snap-align:start;cursor:pointer;transition:transform .2s;position:relative}
.card:hover{transform:scale(1.03)}
.card img{width:100%;height:180px;object-fit:cover}
.card-content{padding:10px}
.card-content h3{font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.embed-container{position:relative;padding-bottom:100%;height:0;overflow:hidden;margin-top:10px;border-radius:10px}
.embed-container iframe{position:absolute;top:0;left:0;width:100%;height:100%}
.embed-overlay{position:absolute;top:0;left:0;right:0;bottom:0;cursor:pointer;background:transparent}
.loading{text-align:center;padding:20px;color:#aaa}
.view{display:none}
.view.active{display:block}
.search-container{display:flex;align-items:center;background:#2d2d2d;border-radius:25px;padding:10px 15px;margin:15px 0}
.search-container input{flex:1;min-width:0;border:none;background:transparent;color:#fff;outline:none}
.search-container button{background:none;border:none;color:#fff;cursor:pointer}
.panel{background:#1e1e1e;border-radius:14px;padding:15px}
.search-results{display:none}
.search-results.show{display:block}
.result-item{background:#2a2a2a;border-radius:16px;padding:15px;margin-bottom:15px;display:flex;flex-direction:column;gap:12px}
.result-item:last-child{margin-bottom:0}
.result-top{display:flex;gap:12px;align-items:flex-start;min-width:0}
.result-top img{width:70px;height:70px;border-radius:12px;object-fit:cover;flex:0 0 auto}
.result-info{flex:1;min-width:0;overflow:hidden}
.result-info h3{font-size:16px;line-height:1.25;margin-bottom:6px;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}
.result-info p{font-size:13px;color:#b3b3b3;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}
.result-actions{display:flex;gap:10px}
.btn{flex:1;border:none;border-radius:25px;padding:10px 12px;font-weight:700;cursor:pointer}
.btn.download{background:#3d3d3d;color:#fff}
.btn.open{background:#1DB954;color:#fff}
.btn:active{transform:scale(.98)}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:#121212;border-top:1px solid #333;display:flex;justify-content:space-around;padding:10px 0;z-index:1000}
.nav-item{display:flex;flex-direction:column;align-items:center;color:#aaa;text-decoration:none;font-size:12px;padding:6px 12px}
.nav-item.active{color:#1DB954}
.nav-item i{font-size:22px;margin-bottom:4px}
@media(min-width:768px){
.card{flex:0 0 200px}
.card img{height:200px}
}
</style>
</head>
<body>

<div class="app-container">
  <div class="container">

    <div id="homeView" class="view active">
      <h1>Spotify Dashboard</h1>

      <div class="section">
        <h2>Trending Songs</h2>
        <div class="carousel-container"><div class="carousel" id="trendingSongs"></div></div>
      </div>

      <div class="section">
        <h2>Popular Artists</h2>
        <div class="carousel-container"><div class="carousel" id="popularArtists"></div></div>
      </div>

      <div class="section">
        <h2>Popular Albums</h2>
        <div class="carousel-container"><div class="carousel" id="popularAlbums"></div></div>
      </div>

      <div class="section">
        <h2>Popular Radio</h2>
        <div class="carousel-container"><div class="carousel" id="popularRadio"></div></div>
      </div>

      <div class="section">
        <h2>Featured Charts</h2>
        <div class="carousel-container"><div class="carousel" id="featuredCharts"></div></div>
      </div>
    </div>

    <div id="searchView" class="view">
      <h1>Search</h1>
      <div class="search-container">
        <input type="text" id="searchInput" placeholder="Search for songs...">
        <button id="searchButton"><i class="fas fa-search"></i></button>
      </div>
      <div class="panel search-results" id="searchResults"></div>
    </div>

    <div id="downloadView" class="view">
      <h1>Downloader</h1>
      <div class="panel">
        <div style="color:#b3b3b3;margin-bottom:10px;line-height:1.4">
          Download Songs, Playlists, Albums &amp; Artist Songs from Spotify
        </div>
        <div class="search-container" style="margin:0">
          <input type="text" id="downloadUrlInput" placeholder="Paste Spotify URL here...">
          <button id="downloadBtn"><i class="fas fa-download"></i></button>
        </div>
        <div id="downloadStatus" style="margin-top:10px;color:#aaa;word-break:break-word"></div>
        <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn download" id="openDownloadBtn" style="flex:1">Open Download</button>
          <button class="btn download" id="clearDownloadBtn" style="flex:1">Clear</button>
        </div>
      </div>
    </div>

  </div>
</div>

<div class="bottom-nav">
  <a href="#" class="nav-item active" data-view="homeView"><i class="fas fa-home"></i><span>Home</span></a>
  <a href="#" class="nav-item" data-view="searchView"><i class="fas fa-search"></i><span>Search</span></a>
  <a href="#" class="nav-item" data-view="downloadView"><i class="fas fa-download"></i><span>Download</span></a>
</div>

<script>
const HOME_API="/spotify/home"
let lastDownloadLink=""

function setView(id){
document.querySelectorAll(".view").forEach(v=>v.classList.remove("active"))
document.getElementById(id).classList.add("active")
document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"))
document.querySelector(`.nav-item[data-view="${id}"]`).classList.add("active")
if(id==="searchView")document.getElementById("searchInput").focus()
if(id==="downloadView")document.getElementById("downloadUrlInput").focus()
}

document.querySelectorAll(".nav-item").forEach(item=>{
item.addEventListener("click",e=>{
e.preventDefault()
setView(item.dataset.view)
})
})

function first(){
for(let i=0;i<arguments.length;i++){
const v=arguments[i]
if(v!==undefined&&v!==null&&String(v).trim()!=="")return v
}
return ""
}

function resolveHomeItem(item,isRadio){
const title=first(item.title,item.name)
const href=first(item.href,item.url,item.link)
const image=first(isRadio?item.image:null,item.thumbnail,item.image)
const embed=first(item.embedUrl,isRadio?item.playlist:null,item.playlist,item.embed)
const embedClick=embed || ""
return {title,href,image,embed,embedClick}
}

function renderHomeCards(containerId,items,isRadio){
const c=document.getElementById(containerId)
c.innerHTML=""
if(!Array.isArray(items)||items.length===0){
c.innerHTML='<div class="loading">No items.</div>'
return
}
items.forEach(item=>{
const f=resolveHomeItem(item,!!isRadio)
const card=document.createElement("div")
card.className="card"
card.addEventListener("click",e=>{
if(e.target && e.target.closest && e.target.closest(".embed-container"))return
if(f.href)window.open(f.href,"_blank")
})
const safeEmbedClick=(f.embedClick||"").replace(/"/g,"&quot;")
card.innerHTML=`
<img src="${f.image||'https://via.placeholder.com/300x300?text=Spotify'}" alt="${f.title}">
<div class="card-content">
<h3 title="${f.title}">${f.title}</h3>
${f.embed?`<div class="embed-container"><iframe src="${f.embed}" frameborder="0" allow="encrypted-media"></iframe><div class="embed-overlay" data-link="${safeEmbedClick}"></div></div>`:""}
</div>`
const overlay=card.querySelector(".embed-overlay")
if(overlay){
overlay.addEventListener("click",e=>{
e.preventDefault()
e.stopPropagation()
const link=overlay.getAttribute("data-link")
if(link)window.open(link,"_blank")
})
}
c.appendChild(card)
})
}

async function loadHome(){
document.querySelectorAll(".carousel").forEach(c=>c.innerHTML='<div class="loading">Loading...</div>')
try{
const res=await fetch(HOME_API)
const data=await res.json()
const r=data.results||{}
renderHomeCards("trendingSongs",r.trendingSongs,false)
renderHomeCards("popularArtists",r.popularArtists,false)
renderHomeCards("popularAlbums",r.popularAlbums,false)
renderHomeCards("popularRadio",r.popularRadio,true)
renderHomeCards("featuredCharts",r.featuredCharts,true)
}catch(e){
console.error(e)
document.querySelectorAll(".carousel").forEach(c=>c.innerHTML='<div class="loading">Failed to load.</div>')
}
}

function buildDownloadLink(url){
return `/Spotify/download?url=${encodeURIComponent(url)}`
}

function renderSearch(data){
const box=document.getElementById("searchResults")
const songs=Array.isArray(data&&data.songs)?data.songs:[]
if(!songs.length){
box.innerHTML='<div class="loading">No results found.</div>'
return
}
box.innerHTML=""
songs.slice(0,20).forEach(song=>{
const title=first(song.title)
const artist=first(song.artist)
const duration=first(song.duration)
const thumb=first(song.thumbnail,"https://via.placeholder.com/100?text=Spotify")
const url=first(song.url)
const item=document.createElement("div")
item.className="result-item"
item.innerHTML=`
<div class="result-top">
<img src="${thumb}" alt="${title}">
<div class="result-info">
<h3>${title}</h3>
<p>${artist}${duration?(" • "+duration):""}</p>
</div>
</div>
<div class="result-actions">
<button class="btn download">To Download</button>
<button class="btn open">Open</button>
</div>`
item.querySelector(".btn.download").onclick=()=>{
document.getElementById("downloadUrlInput").value=url
lastDownloadLink=""
document.getElementById("downloadStatus").textContent="URL pasted."
setView("downloadView")
}
item.querySelector(".btn.open").onclick=()=>{if(url)window.open(url,"_blank")}
box.appendChild(item)
})
}

async function doSearch(){
const q=document.getElementById("searchInput").value.trim()
if(!q)return
const box=document.getElementById("searchResults")
box.classList.add("show")
box.innerHTML='<div class="loading">Searching...</div>'
try{
const res=await fetch(`/song-details?search=${encodeURIComponent(q)}`)
const data=await res.json()
renderSearch(data)
}catch(e){
console.error(e)
box.innerHTML='<div class="loading">Error searching. Try again.</div>'
}
}

document.getElementById("searchButton").addEventListener("click",doSearch)
document.getElementById("searchInput").addEventListener("keydown",e=>{if(e.key==="Enter")doSearch()})

function openDownload(){
const url=document.getElementById("downloadUrlInput").value.trim()
if(!url){
document.getElementById("downloadStatus").textContent="Paste a Spotify URL first."
return
}
lastDownloadLink=buildDownloadLink(url)
window.open(lastDownloadLink,"_blank")
document.getElementById("downloadStatus").textContent="Opening..."
}

document.getElementById("downloadBtn").addEventListener("click",openDownload)
document.getElementById("openDownloadBtn").addEventListener("click",openDownload)

document.getElementById("clearDownloadBtn").addEventListener("click",()=>{
document.getElementById("downloadUrlInput").value=""
lastDownloadLink=""
document.getElementById("downloadStatus").textContent=""
})

document.getElementById("downloadUrlInput").addEventListener("keydown",e=>{if(e.key==="Enter")openDownload()})

document.addEventListener("DOMContentLoaded",()=>{
loadHome()
setView("homeView")
})
</script>

</body>
</html>
